name = "") +
scale_shape_manual(values = c(mean = 21, selected = 16))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender)) +
geom_point(size = 2, shape = 21, stroke = 1,
aes(y = mean, x = variable, color = gender), fill = "grey90") +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender)) +
geom_point(size = 2, shape = 21, stroke = 1,
aes(y = mean, x = variable, color = gender), fill = "grey90") +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durschnitt', codes_faculty[codes_faculty$code == faculty_code, ]$faculty),
values=c('Durschnitt'=21, codes_faculty[codes_faculty$code == faculty_code, ]$faculty=16)) +
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender)) +
geom_point(size = 2, shape = 21, stroke = 1,
aes(y = mean, x = variable, color = gender), fill = "grey90") +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durschnitt', name_faculty),
values=c('Durschnitt'=21, name_faculty=16)) +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender)) +
geom_point(size = 2, shape = 21, stroke = 1,
aes(y = mean, x = variable, color = gender), fill = "grey90") +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durschnitt', name_faculty),
values=c('Durschnitt'=21, name_faculty=16)) +
scale_size_manual(breaks=c('Durschnitt', name_faculty),
values=c('Durschnitt'=2, name_faculty=6)) +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
aes(y = mean, x = variable, color = gender, shape = Durchschnitt, fill = "grey90") +
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = name_faculty)) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = Durchschnitt, fill = "grey90")) +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durschnitt', name_faculty),
values=c('Durschnitt'=21, name_faculty=16)) +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = name_faculty)) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = Durchschnitt, fill = "grey90")) +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durschnitt', name_faculty),
values=c('Durschnitt'=21, name_faculty=16)) +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = name_faculty)) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt", fill = "grey90")) +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durschnitt', name_faculty),
values=c('Durschnitt'=21, name_faculty=16)) +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = "Fakultät")) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt", fill = "grey90")) +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durschnitt', "Fakultät"),
values=c('Durschnitt'=21, "Fakultät"=16)) +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = "Fakultät")) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt", fill = "grey90")) +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durchschnitt', "Fakultät"),
values=c('Durchschnitt'=21, "Fakultät"=16)) +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(aes(y = selected, x = variable, color = gender, shape = "Fakultät", size = "Fakultät")) +
geom_point(stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt", size = "Durchschnitt", fill = "grey90")) +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durchschnitt', "Fakultät"),
values=c('Durchschnitt'=21, "Fakultät"=16)) +
scale_size_manual(breaks=c('Durchschnitt', "Fakultät"),
values=c('Durchschnitt'=2, "Fakultät"=6)) +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = "Fakultät")) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt", fill = "grey90")) +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durchschnitt', "Fakultät"),
values=c('Durchschnitt'=21, "Fakultät"=16)) +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = "Fakultät")) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt", fill = "grey90")) +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durchschnitt', "Fakultät"),
values=c('Durchschnitt'=21, "Fakultät"=16),
name = "") +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = "Fakultät")) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt"), fill = "grey90") +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durchschnitt', "Fakultät"),
values=c('Durchschnitt'=21, "Fakultät"=16),
name = "") +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue, show.legend = FALSE,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = "Fakultät")) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt"), fill = "grey90") +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durchschnitt', "Fakultät"),
values=c('Durchschnitt'=21, "Fakultät"=16),
name = "") +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue, show.legend = FALSE,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = name_faculty)) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt"), fill = "grey90") +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durchschnitt', name_faculty),
values=c('Durchschnitt'=21, name_faculty=16),
name = "") +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue, show.legend = FALSE,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = "Fakultät")) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt"), fill = "grey90") +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durchschnitt', "Fakultät"),
values=c('Durchschnitt'=21, "Fakultät"=16),
name = "") +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
df_faculty_selected$gender = factor(df_faculty_selected$gender, levels = c("weiblich", "andere"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue, show.legend = FALSE,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = "Fakultät")) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt"), fill = "grey90") +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durchschnitt', "Fakultät"),
values=c('Durchschnitt'=21, "Fakultät"=16),
name = "") +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
df_faculty_selected$variable = factor(df_faculty_selected$variable, levels = c("Teilnehmende in % Studierende", "Betroffene in % Teilnehmende", "Betroffene in % Studierende"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue, show.legend = FALSE,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = "Fakultät")) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt"), fill = "grey90") +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durchschnitt', "Fakultät"),
values=c('Durchschnitt'=21, "Fakultät"=16),
name = "") +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
df_faculty_selected$variable = factor(df_faculty_selected$variable, levels = c("Betroffene in % Studierende", "Betroffene in % Teilnehmende", "Teilnehmende in % Studierende"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue, show.legend = FALSE,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = "Fakultät")) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt"), fill = "grey90") +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durchschnitt', "Fakultät"),
values=c('Durchschnitt'=21, "Fakultät"=16),
name = "") +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue, show.legend = FALSE,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = "Fakultät")) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt"), fill = "grey90") +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durchschnitt', "Fakultät"),
values=c('Durchschnitt'=21, "Fakultät"=16),
name = "") +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggsave(paste0("reports/figures/benchmark_", codes_faculty[codes_faculty$code == faculty_code, ]$faculty, ".png"), dpi = 700, width = 10)
ggsave(paste0("reports/figures/benchmark_", codes_faculty[codes_faculty$code == faculty_code, ]$faculty, ".png"), dpi = 700, width = 11, 6)
ggsave(paste0("reports/figures/benchmark_", codes_faculty[codes_faculty$code == faculty_code, ]$faculty, ".png"), dpi = 700, width = 11, height = 6)
ggsave(paste0("reports/figures/benchmark_", codes_faculty[codes_faculty$code == faculty_code, ]$faculty, ".png"), dpi = 700, width = 11, height = 4)
ggsave(paste0("reports/figures/benchmark_", codes_faculty[codes_faculty$code == faculty_code, ]$faculty, ".png"), dpi = 700, width = 11, height = 2)
#faculty comparison
faculty_benchmark = function(faculty_code, full_data = full_data, main_question_q3 = main_question_q3 , codes_faculty = codes_faculty, codes_gender = codes_gender) {
df_faculty_affected = full_data %>%
select(Q2.2, Q2.1, main_question_q3) %>%
filter(!is.na(Q2.2),
!is.na(Q2.1)) %>%
mutate(faculty = codes_faculty$faculty[match(Q2.2, codes_faculty$code)],
gender = codes_gender$gender[match(Q2.1, codes_gender$code)],
gender = replace(gender, gender %in% c("männlich", "keine Angabe"), "andere")) %>%
filter_at(vars(main_question_q3), any_vars (. == 1)) %>%
select(-Q2.2, -Q2.1) %>%
count(faculty, gender)
df_faculty_all = full_data %>%
select(Q2.2, Q2.1) %>%
filter(!is.na(Q2.2),
!is.na(Q2.1)) %>%
mutate(faculty = codes_faculty$faculty[match(Q2.2, codes_faculty$code)],
gender = codes_gender$gender[match(Q2.1, codes_gender$code)],
gender = replace(gender, gender %in% c("männlich", "keine Angabe"), "andere")) %>%
count(faculty, gender) %>%
rename("Teilnehmende" = n) %>%
left_join(df_faculty_affected) %>%
rename("Betroffene" = n) %>%
filter(faculty != "keine Angabe")
df_faculty = df_faculty_all %>%
left_join(df_all_students_gender) %>%
mutate("Teilnehmende in % Studierende" = 100*Teilnehmende/ Studierende,
"Betroffene in % Teilnehmende" = 100*Betroffene/ Teilnehmende,
"Betroffene in % Studierende" = 100*Betroffene/ Studierende)
df_faculty_mean = df_faculty %>%
group_by(gender) %>%
summarize_at(c("Teilnehmende in % Studierende", "Betroffene in % Teilnehmende", "Betroffene in % Studierende"), ~ mean(.x, na.rm = TRUE)) %>%
melt(id.vars = "gender", value.name = "mean")
df_faculty_selected = df_faculty %>%
filter(faculty == codes_faculty[codes_faculty$code == faculty_code, ]$faculty)  %>%
select(gender, c("Teilnehmende in % Studierende", "Betroffene in % Teilnehmende", "Betroffene in % Studierende")) %>%
melt(id.vars = "gender", value.name = "selected") %>%
left_join(df_faculty_mean) %>%
mutate(direction = (case_when(mean < selected ~ "überdurchschnittlich",
mean > selected ~ "unterdurchschnittlich",
mean == selected ~ "durchschnittlich")))
df_faculty_selected$gender = factor(df_faculty_selected$gender, levels = c("weiblich", "andere"))
df_faculty_selected$variable = factor(df_faculty_selected$variable, levels = c("Betroffene in % Studierende", "Betroffene in % Teilnehmende", "Teilnehmende in % Studierende"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue, show.legend = FALSE,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = "Fakultät")) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt"), fill = "grey90") +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durchschnitt', "Fakultät"),
values=c('Durchschnitt'=21, "Fakultät"=16),
name = "") +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggsave(paste0("reports/figures/benchmark_", codes_faculty[codes_faculty$code == faculty_code, ]$faculty, ".png"), dpi = 700, width = 11, height = 2)
}
View(codes_faculty)
for (i in c(1:6)) {
faculty_benchmark(i)
}
for (i in c(1:6)) {
faculty_benchmark(faculty_code = i)
}
#faculty comparison
faculty_benchmark = function(faculty_code, full_data, main_question_q3, codes_faculty, codes_gender) {
df_faculty_affected = full_data %>%
select(Q2.2, Q2.1, main_question_q3) %>%
filter(!is.na(Q2.2),
!is.na(Q2.1)) %>%
mutate(faculty = codes_faculty$faculty[match(Q2.2, codes_faculty$code)],
gender = codes_gender$gender[match(Q2.1, codes_gender$code)],
gender = replace(gender, gender %in% c("männlich", "keine Angabe"), "andere")) %>%
filter_at(vars(main_question_q3), any_vars (. == 1)) %>%
select(-Q2.2, -Q2.1) %>%
count(faculty, gender)
df_faculty_all = full_data %>%
select(Q2.2, Q2.1) %>%
filter(!is.na(Q2.2),
!is.na(Q2.1)) %>%
mutate(faculty = codes_faculty$faculty[match(Q2.2, codes_faculty$code)],
gender = codes_gender$gender[match(Q2.1, codes_gender$code)],
gender = replace(gender, gender %in% c("männlich", "keine Angabe"), "andere")) %>%
count(faculty, gender) %>%
rename("Teilnehmende" = n) %>%
left_join(df_faculty_affected) %>%
rename("Betroffene" = n) %>%
filter(faculty != "keine Angabe")
df_faculty = df_faculty_all %>%
left_join(df_all_students_gender) %>%
mutate("Teilnehmende in % Studierende" = 100*Teilnehmende/ Studierende,
"Betroffene in % Teilnehmende" = 100*Betroffene/ Teilnehmende,
"Betroffene in % Studierende" = 100*Betroffene/ Studierende)
df_faculty_mean = df_faculty %>%
group_by(gender) %>%
summarize_at(c("Teilnehmende in % Studierende", "Betroffene in % Teilnehmende", "Betroffene in % Studierende"), ~ mean(.x, na.rm = TRUE)) %>%
melt(id.vars = "gender", value.name = "mean")
df_faculty_selected = df_faculty %>%
filter(faculty == codes_faculty[codes_faculty$code == faculty_code, ]$faculty)  %>%
select(gender, c("Teilnehmende in % Studierende", "Betroffene in % Teilnehmende", "Betroffene in % Studierende")) %>%
melt(id.vars = "gender", value.name = "selected") %>%
left_join(df_faculty_mean) %>%
mutate(direction = (case_when(mean < selected ~ "überdurchschnittlich",
mean > selected ~ "unterdurchschnittlich",
mean == selected ~ "durchschnittlich")))
df_faculty_selected$gender = factor(df_faculty_selected$gender, levels = c("weiblich", "andere"))
df_faculty_selected$variable = factor(df_faculty_selected$variable, levels = c("Betroffene in % Studierende", "Betroffene in % Teilnehmende", "Teilnehmende in % Studierende"))
ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue, show.legend = FALSE,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = "Fakultät")) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt"), fill = "grey90") +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durchschnitt', "Fakultät"),
values=c('Durchschnitt'=21, "Fakultät"=16),
name = "") +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black"))
ggsave(paste0("reports/figures/benchmark_", codes_faculty[codes_faculty$code == faculty_code, ]$faculty, ".png"), dpi = 700, width = 11, height = 2)
}
for (i in c(1:6)) {
faculty_benchmark(faculty_code = i, full_data, main_question_q3, codes_faculty, codes_gender)
}
