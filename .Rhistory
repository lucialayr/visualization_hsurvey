levels = rev(codes_faculty$faculty))
df_faculty$gender = factor(df_faculty$gender,
levels = rev(codes_gender$gender))
(p2 = ggplot(data = df_faculty, aes(x = faculty), color = "white") + theme_void() +
geom_bar(color = "white", stat = "identity", width = 0.7,
aes(y = students, fill = gender)) +
geom_bar(color = "white", stat = "identity", alpha = .4,  width = 0.7,
aes(y = share, fill = gender)) +
geom_text(aes(y = 0, label = faculty, x = factor(faculty)), size = 5,
hjust = 0, nudge_x = 0.5, check_overlap = TRUE) +
coord_flip() +
geom_hline(yintercept = 0) +
scale_y_continuous(expand = c(0,0), breaks = c(-75*2, -100, -50,  100, 200), limits = c(-175, 300), labels = c("75 %", "50 %", "25 %", 100, 200)) +
scale_fill_manual(values = c("weiblich" = dark_blue, "männlich" = teal,  "keine Angabe" = soft_blue,
"share_female" = dark_blue, "share_other" = teal),
name = "") +
theme(axis.text.x = element_text(color = "grey20"),
axis.line.x = element_line(),
legend.position = "None",
text = element_text(size = 12)) +
guides(fill = guide_legend(reverse=T)))
ggsave("reports/figures/P2.png", dpi = 700)
#what happended
main_question = c("Q3.1", "Q3.5", "Q3.9", "Q3.13", "Q3.17", "Q3.21", "Q3.25", "Q3.29", "Q3.33", "Q3.37", "Q3.41", "Q3.45", "Q3.49", "Q3.53", "Q3.57")
long_names= lookup_names$lang[match(main_question, lookup_names$kurz)]
#absolute values
df_incident = full_data %>%
select(all_of(main_question), "Q2.1") %>%
mutate(gender = codes_gender$gender[match(Q2.1, codes_gender$code)]) %>%
select(-Q2.1) %>%
filter_all(any_vars(. == 1)) %>%
melt(id.vars = c("gender")) %>%
filter(!is.na(value),
!is.na(variable),
!is.na(gender),
value == 1) %>%
count(gender, variable)
ggplot() + theme_void() +
coord_flip() +
scale_x_discrete(labels =str_wrap(str_replace_all(long_names, "foo" , " "), width = 70), expand = c(0,0)) + #induce line break
scale_y_continuous(expand = c(0,0), limits = c(0, 160), breaks = c(50, 100, 150)) +
geom_bar(data = df_incident, stat = "identity", color = "white",
aes(x = variable, y = n, fill = gender)) +
theme(legend.position = "None",
axis.text = element_text(color = "grey20"),
axis.line = element_line()) +
scale_fill_manual(values = values_gender, name = "")
ggsave("reports/figures/P3.1.png", dpi = 700)
#zeugen
main_question = c("Q4.1", "Q4.7", "Q4.13", "Q4.19", "Q4.25", "Q4.31", "Q4.37", "Q4.43",
"Q4.49", "Q4.55", "Q4.61", "Q4.67", "Q4.73", "Q4.79")
long_names= lookup_names$lang[match(main_question, lookup_names$kurz)]
#absolute values
df_whitness = full_data %>%
select(all_of(main_question), "Q2.1") %>%
mutate(gender = codes_gender$gender[match(Q2.1, codes_gender$code)]) %>%
select(-Q2.1) %>%
filter_all(any_vars(. == 1)) %>%
melt(id.vars = c("gender")) %>%
filter(!is.na(value),
!is.na(variable),
!is.na(gender),
value == 1) %>%
count(gender, variable)
ggplot() + theme_void() +
coord_flip() +
scale_x_discrete(labels =str_wrap(str_replace_all(long_names, "foo" , " "), width = 70), expand = c(0,0)) + #induce line break
scale_y_continuous(expand = c(0,0), limits = c(0, 160), breaks = c(50, 100, 150)) +
geom_bar(data = df_whitness, stat = "identity", color = "white",
aes(x = variable, y = n, fill = gender)) +
theme(legend.position = "None",
axis.text = element_text(color = "grey20"),
axis.line = element_line()) +
scale_fill_manual(values = values_gender, name = "")
ggsave("reports/figures/P3.2.png", dpi = 700)
##zeugen und erlebtes
q3q4_paare = read.csv("data/processed/Q3_Q4_Paare.csv")
df_whitness_join = df_whitness %>%
rename("Q4_n" = n,
"variable_Q4" = variable)
df_incident_join = df_incident %>%
rename("Q3_n" = n,
"variable_Q3" = variable) %>%
mutate(variable_Q4 = q3q4_paare$Q4[match(variable_Q3, q3q4_paare$Q3)],
name = q3q4_paare$gesehen[match(variable_Q3, q3q4_paare$Q3)]) %>%
left_join(df_whitness_join) %>%
mutate(Q3_n = -Q3_n) %>%
filter(!is.na(Q4_n))
# Barplot
(ggplot(data = df_incident_join, aes(x = reorder(name, Q3_n, sum))) + theme_void() +
geom_bar(color = "white", stat = "identity", width = 0.6,
aes(y = Q3_n, fill = gender)) +
geom_bar(color = "white", stat = "identity", width = 0.6,
aes(y = Q4_n, fill = gender)) +
geom_text(aes(y = 0, label =name, x = factor(name)), size = 4,
hjust = .5, nudge_x = -0.45, check_overlap = TRUE) +
coord_flip() +
scale_y_continuous(expand = c(0,0), limits = c(-155, 155), breaks = c(0, 100, 150)) +
scale_fill_manual(values = values_gender,
name = "") +
theme(axis.text.x = element_text(color = "grey20"),
axis.line.x = element_line(color = "grey20"),
legend.position = "None",
text = element_text(size = 12)) +
guides(fill = guide_legend(reverse=T)))
ggsave("reports/figures/P3.3.png", dpi = 700, width = 10, height = 8)
#wer sieht, wem passiert?
main_question_q3 = c("Q3.1", "Q3.5", "Q3.9", "Q3.13", "Q3.17", "Q3.21", "Q3.25", "Q3.29",
"Q3.33", "Q3.37", "Q3.41", "Q3.45", "Q3.49", "Q3.53", "Q3.57")
main_question_q4 = c("Q4.1", "Q4.7", "Q4.13", "Q4.19", "Q4.25", "Q4.31", "Q4.37", "Q4.43",
"Q4.49", "Q4.55", "Q4.61", "Q4.67", "Q4.73", "Q4.79")
df_groups = full_data %>%
select(Q2.1,  all_of(main_question_q3), all_of(main_question_q4)) %>%
mutate(q3 = ifelse(if_any(main_question_q3, ~ .x == 1),  1, 0),
q4 = ifelse(if_any(main_question_q4, ~ .x == 1),  1, 0),
gender = codes_gender$gender[match(Q2.1, codes_gender$code)])
ggplot() + theme_void() +
coord_equal() +
geom_hline(yintercept = .5) +
geom_vline(xintercept = .5) +
scale_x_reverse(name = "erlebt", position = "top",
breaks = c(1, 0), labels = c("betroffen", "nicht betroffen")) +
scale_y_continuous(breaks = c(1, 0), labels = c("beobachtet", "nicht beobachtet")) +
geom_point(data = df_groups, position = position_jitter(),
aes(x = q3, y = q4, fill = gender), color = "white", shape = 21, stroke = .75, size = 3.5, alpha = .9) +
scale_fill_manual(values = values_gender,
name = "") +
theme(axis.text = element_text(),
axis.text.y = element_text(angle = 90))
ggsave("reports/figures/P3.4.png", dpi = 700)
#handelnde person gender
fem = c("Q3.3A1",  "Q3.7A1", "Q3.11A1", "Q3.15A1", "Q3.19A1", "Q3.23A1", "Q3.27A1", "Q3.31A1", "Q3.35A1", "Q3.39A1", "Q3.43A1", "Q3.47A1", "Q3.51A1","Q3.55A1", "Q3.59A1",
"Q3.3A3","Q3.7A3", "Q3.11A3", "Q3.15A3", "Q3.19A3", "Q3.23A3", "Q3.27A3", "Q3.31A3", "Q3.35A3", "Q3.39A3", "Q3.43A3", "Q3.47A3", "Q3.51A3","Q3.55A3", "Q3.59A3")
male = c("Q3.3A2",  "Q3.7A2", "Q3.11A2", "Q3.15A2", "Q3.19A2", "Q3.23A2", "Q3.27A2", "Q3.31A2", "Q3.35A2", "Q3.39A2", "Q3.43A2", "Q3.47A2", "Q3.51A2","Q3.55A2", "Q3.59A2")
other = c("Q3.3A4",  "Q3.7A4", "Q3.11A4", "Q3.15A4", "Q3.19A4", "Q3.23A4", "Q3.27A4", "Q3.31A4", "Q3.35A4", "Q3.39A4", "Q3.43A4", "Q3.47A4", "Q3.51A4","Q3.55A4", "Q3.59A4")
df_offender = full_data %>%
select(Q2.1, fem, male, other) %>%
group_by(Q2.1) %>%
summarize(across(everything(), ~ sum(.x, na.rm = TRUE))) %>%
filter(!is.na(Q2.1)) %>%
mutate("weiblich" = rowSums(across(fem)),
"männlich" = rowSums(across(male)),
"keine Angabe" = rowSums(across(other)),
"gender_1" = codes_gender$gender[match(Q2.1, codes_gender$code)]) %>%
select("gender_1", "weiblich", "männlich", "keine Angabe") %>%
melt(id.vars = "gender_1")
df_offender$variable = factor(df_offender$variable, levels = c("weiblich", "männlich", "keine Angabe"))
df_offender$gender_1 = factor(df_offender$gender_1, levels = codes_gender$gender)
p1 = ggplot() + theme_void() +
geom_bar(data = df_offender[df_offender$gender_1 %in% c("weiblich", "männlich"),], stat = "identity", position = "fill", color = "white",
aes(x = gender_1, y = value, fill = variable)) +
scale_fill_manual(values = values_gender,
name = "Handelnde Person") +
scale_y_continuous(breaks = c(0, 0.5, 1), labels = c("0 %", "50 %", "100 %")) +
scale_x_discrete(name = "Betroffene Person") +
theme(axis.text = element_text(), axis.title.x = element_text())
p2 = ggplot() + theme_void() +
geom_bar(data = df_offender, stat = "identity", color = "white",
aes(x = gender_1, y = value, fill = variable)) +
scale_fill_manual(values = values_gender,
name = "Handelnde Person") +
scale_x_discrete(name = "Betroffene Person") +
theme(axis.text = element_text(),
axis.title.x = element_text())
df_offender_summarized = full_data %>%
select(Q2.1, fem, male, other) %>%
group_by(Q2.1) %>%
summarize(across(everything(), ~ sum(.x, na.rm = TRUE))) %>%
filter(!is.na(Q2.1)) %>%
mutate("weiblich" = rowSums(across(fem)),
"männlich" = rowSums(across(male)),
"keine Angabe" = rowSums(across(other)),
"gender_1" = codes_gender$gender[match(Q2.1, codes_gender$code)]) %>%
select("weiblich", "männlich", "keine Angabe") %>%
summarize(across(everything(), ~ sum(.x, na.rm = TRUE))) %>%
melt() %>%
mutate(fraction = value/sum(value)) %>%
mutate(ymax = cumsum(fraction))
df = df_offender_summarized %>%
mutate(ymin = c(0, head(df_offender_summarized$ymax, n = -1)))
(p3 = ggplot(data = df, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=variable)) + theme_void() +
scale_y_continuous(name = "") +
scale_x_continuous(limits = c(1.5, 4)) +
scale_fill_manual(values = values_gender,
name = "Handelnde Person") +
coord_polar(theta = "y") +
geom_rect(color = "white") +
theme(text = element_text(size = 15),
legend.position = "bottom",
legend.direction = "vertical"))
(p = plot_grid(p3, p2, p1, nrow = 1))
ggsave("reports/figures/P4.1.png", dpi = 700, width = 15)
#handelnde Person
main_question_q3 = c("Q3.1", "Q3.5", "Q3.9", "Q3.13", "Q3.17", "Q3.21", "Q3.25", "Q3.29",
"Q3.33", "Q3.37", "Q3.41", "Q3.45", "Q3.49", "Q3.53", "Q3.57")
main_question_q4 = c("Q4.1", "Q4.7", "Q4.13", "Q4.19", "Q4.25", "Q4.31", "Q4.37", "Q4.43",
"Q4.49", "Q4.55", "Q4.61", "Q4.67", "Q4.73", "Q4.79")
stud = c("Q3.2A1", "Q3.6A1", "Q3.10A1", "Q3.14A1", "Q3.18A1", "Q3.22A1",
"Q3.26A1", "Q3.30A1", "Q3.34A1", "Q3.38A1", "Q3.42A1", "Q3.46A1", "Q3.50A1", "Q3.54A1", "Q3.58A1")
doz = c("Q3.2A2", "Q3.6A2", "Q3.10A2", "Q3.14A2", "Q3.18A2", "Q3.22A2",
"Q3.26A2", "Q3.30A2", "Q3.34A2", "Q3.38A2", "Q3.42A2", "Q3.46A2", "Q3.50A2", "Q3.54A2", "Q3.58A2")
ang = c("Q3.2A3", "Q3.6A3", "Q3.10A3", "Q3.14A3", "Q3.18A3", "Q3.22A3",
"Q3.26A3", "Q3.30A3", "Q3.34A3", "Q3.38A3", "Q3.42A3", "Q3.46A3", "Q3.50A3", "Q3.54A3", "Q3.58A3")
df_offender = full_data %>%
select(Q2.1, stud, doz, ang) %>%
group_by(Q2.1) %>%
summarize(across(everything(), ~ sum(.x, na.rm = TRUE))) %>%
filter(!is.na(Q2.1)) %>%
mutate("Mitstudierende*r" = rowSums(across(stud)),
"Dozierende*r" = rowSums(across(doz)),
"HTWG Angestellte*r" = rowSums(across(ang)),
"gender" = codes_gender$gender[match(Q2.1, codes_gender$code)]) %>%
select("gender", "Mitstudierende*r", "Dozierende*r", "HTWG Angestellte*r") %>%
melt(id.vars = "gender")
df_offender$variable = factor(df_offender$variable, levels = c("Mitstudierende*r", "Dozierende*r",  "HTWG Angestellte*r"))
df_offender$gender = factor(df_offender$gender, levels = codes_gender$gender)
p1 = ggplot() + theme_void() +
geom_bar(data = df_offender[df_offender$gender %in% c("weiblich", "männlich"),], stat = "identity", position = "fill", color = "white",
aes(x = gender, y = value, fill = variable)) +
scale_fill_manual(values = c("Mitstudierende*r" = dark_blue, "HTWG Angestellte*r" = soft_blue, "Dozierende*r" = teal),
name = "Handelnde Person") +
scale_y_continuous(breaks = c(0, 0.5, 1), labels = c("0 %", "50 %", "100 %")) +
scale_x_discrete(name = "Betroffene Person") +
theme(axis.text = element_text(),
axis.title.x = element_text())
p2 = ggplot() + theme_void() +
geom_bar(data = df_offender, color = "white", stat = "identity",
aes(x = gender, y = value, fill = variable)) +
scale_fill_manual(values = c("Mitstudierende*r" = dark_blue, "HTWG Angestellte*r" = soft_blue, "Dozierende*r" = teal),
name = "Handelnde Person") +
scale_x_discrete(name = "Betroffene Person") +
theme(axis.text = element_text(),
axis.title.x = element_text())
df_offender_summarized = full_data %>%
select(Q2.1, stud, doz, ang) %>%
group_by(Q2.1) %>%
summarize(across(everything(), ~ sum(.x, na.rm = TRUE))) %>%
filter(!is.na(Q2.1)) %>%
mutate("Mitstudierende*r" = rowSums(across(stud)),
"Dozierende*r" = rowSums(across(doz)),
"HTWG Angestellte*r" = rowSums(across(ang)),
"gender" = codes_gender$gender[match(Q2.1, codes_gender$code)]) %>%
select("Mitstudierende*r", "Dozierende*r", "HTWG Angestellte*r") %>%
summarize(across(everything(), ~ sum(.x, na.rm = TRUE))) %>%
melt() %>%
mutate(fraction = value/sum(value)) %>%
mutate(ymax = cumsum(fraction))
df = df_offender_summarized %>%
mutate(ymin = c(0, head(df_offender_summarized$ymax, n = -1)))
(p3 = ggplot(data = df, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=variable)) + theme_void() +
scale_y_continuous(name = "") +
scale_x_continuous(limits = c(1.5, 4)) +
scale_fill_manual(values = c("Mitstudierende*r" = dark_blue, "HTWG Angestellte*r" = soft_blue, "Dozierende*r" = teal),
name = "Handelnde Person") +
coord_polar(theta = "y") +
geom_rect( color = "white") +
theme(text = element_text(size = 15),
legend.position = "bottom",
legend.direction = "vertical"))
(p = plot_grid(p3, p2, p1, nrow = 1))
ggsave("reports/figures/P4.2.png", dpi = 700, width = 15)
#was ist passiert pro Fakultät
df_faculty_incident = full_data %>%
select(Q2.2, Q2.1, main_question_q3) %>%
filter(!is.na(Q2.2)) %>%
mutate(faculty = codes_faculty$faculty[match(Q2.2, codes_faculty$code)],
gender = codes_gender$gender[match(Q2.1, codes_gender$code)]) %>%
filter_at(vars(main_question_q3), any_vars (. == 1)) %>%
select(-Q2.2, -Q2.1) %>%
melt(id.vars = c("gender", "faculty")) %>%
filter(value == 1) %>%
count(faculty, gender)
p1 = ggplot() + theme_void() +
geom_bar(data = df_faculty_incident, stat = "identity", color = "white",
aes(x = faculty, y = n, fill = gender)) +
coord_flip() +
scale_fill_manual(values = values_gender,
name = "") +
scale_y_continuous(name = "Anzahl der Vorfälle") +
theme(axis.text = element_text(hjust = 1),
axis.title.x = element_text())
df_faculty_affected = full_data %>%
select(Q2.2, Q2.1, main_question_q3) %>%
filter(!is.na(Q2.2),
!is.na(Q2.1)) %>%
mutate(faculty = codes_faculty$faculty[match(Q2.2, codes_faculty$code)],
gender = codes_gender$gender[match(Q2.1, codes_gender$code)]) %>%
filter_at(vars(main_question_q3), any_vars (. == 1)) %>%
select(-Q2.2, -Q2.1) %>%
count(faculty, gender)
df_faculty_all = full_data %>%
select(Q2.2, Q2.1) %>%
filter(!is.na(Q2.2),
!is.na(Q2.1)) %>%
mutate(faculty = codes_faculty$faculty[match(Q2.2, codes_faculty$code)],
gender = codes_gender$gender[match(Q2.1, codes_gender$code)]) %>%
count(faculty, gender) %>%
rename(n_all = n) %>%
left_join(df_faculty_affected) %>%
mutate(share = n/n_all) %>%
filter(gender %in% c("männlich", "weiblich"),
faculty != "keine Angabe")
p2 = ggplot() + theme_void() +
geom_bar(data = df_faculty_all, stat = "identity", position = "dodge", color = "white",
aes(x = faculty, y = share, fill = gender)) +
coord_flip() +
scale_fill_manual(values = values_gender,
name = "") +
scale_y_continuous(breaks = c(0, 0.25, 0.5), labels = c("0 %", "25 %", "50 %"), name = "Betroffene in % der Befragten") +
theme(axis.text = element_text(hjust = 1),
axis.title.x = element_text())
(p = plot_grid(p1, p2, nrow = 2))
ggsave("reports/figures/P5.1.png", dpi = 700)
#wie unangenehm?
main_question_q3 = c("Q3.1", "Q3.5", "Q3.9", "Q3.13", "Q3.17", "Q3.21", "Q3.25", "Q3.29",
"Q3.33", "Q3.37", "Q3.41", "Q3.45", "Q3.49", "Q3.53", "Q3.57")
scale_q3 = c("Q3.4", "Q3.8", "Q3.12", "Q3.16", "Q3.20", "Q3.24", "Q3.28", "Q3.32",
"Q3.36", "Q3.40", "Q3.44", "Q3.48", "Q3.52", "Q3.56", "Q3.60")
main_question = c("Q3.1", "Q3.5", "Q3.9", "Q3.13", "Q3.17", "Q3.21", "Q3.25", "Q3.29", "Q3.33", "Q3.37", "Q3.41", "Q3.45", "Q3.49", "Q3.53", "Q3.57")
long_names= lookup_names$lang[match(main_question, lookup_names$kurz)]
df_scale = full_data %>%
select(Q2.1,  all_of(scale_q3)) %>%
filter_at(vars(scale_q3), any_vars (!is.na(.))) %>%
mutate(gender = codes_gender$gender[match(Q2.1, codes_gender$code)]) %>%
select(-Q2.1)
names(df_scale) = c(main_question_q3, "gender")
df_scale = df_scale %>%
melt(id.vars = "gender") %>%
filter(!is.na(value),
!is.na(gender)) %>%
mutate(value = as.numeric(value)) %>%
group_by(variable, gender) %>%
summarize(mean = mean(value, na.rm = FALSE),
sd = sd(value, na.rm = FALSE)) %>%
filter(gender %in% c("männlich", "weiblich"),
!is.na(variable),
!is.na(mean))
ggplot(data = df_scale, aes(x = variable, y = mean, color = gender)) + theme_void() +
geom_pointrange(aes(ymin = mean-sd, ymax = mean +sd)) +
coord_flip() +
scale_color_manual(values = values_gender,
name = "") +
scale_x_discrete(labels =str_wrap(str_replace_all(long_names, "foo" , " "), width = 70), expand = c(0.05,0.05)) + #induce line break
theme(axis.line.x = element_line(),
axis.text = element_text())
ggsave("reports/figures/P6.png", dpi = 700, width = 10)
#faculty comparison
faculty_benchmark = function(faculty_code, full_data, main_question_q3, codes_faculty, codes_gender, df_all_students) {
df_all_students_gender = df_all_students %>%
rename(weiblich = total_female,
andere = total_other) %>%
melt(measure.vars = c("weiblich", "andere"), variable.name = "gender", value.name = "Studierende") %>%
select(-total)
df_faculty_affected = full_data %>%
select(Q2.2, Q2.1, main_question_q3) %>%
filter(!is.na(Q2.2),
!is.na(Q2.1)) %>%
mutate(faculty = codes_faculty$faculty[match(Q2.2, codes_faculty$code)],
gender = codes_gender$gender[match(Q2.1, codes_gender$code)],
gender = replace(gender, gender %in% c("männlich", "keine Angabe"), "andere")) %>%
filter_at(vars(main_question_q3), any_vars (. == 1)) %>%
select(-Q2.2, -Q2.1) %>%
count(faculty, gender)
df_faculty_all = full_data %>%
select(Q2.2, Q2.1) %>%
filter(!is.na(Q2.2),
!is.na(Q2.1)) %>%
mutate(faculty = codes_faculty$faculty[match(Q2.2, codes_faculty$code)],
gender = codes_gender$gender[match(Q2.1, codes_gender$code)],
gender = replace(gender, gender %in% c("männlich", "keine Angabe"), "andere")) %>%
count(faculty, gender) %>%
rename("Teilnehmende" = n) %>%
left_join(df_faculty_affected) %>%
rename("Betroffene" = n) %>%
filter(faculty != "keine Angabe")
df_faculty = df_faculty_all %>%
left_join(df_all_students_gender) %>%
mutate("Teilnehmende in % Studierende" = 100*Teilnehmende/ Studierende,
"Betroffene in % Teilnehmende" = 100*Betroffene/ Teilnehmende,
"Betroffene in % Studierende" = 100*Betroffene/ Studierende)
df_faculty_mean = df_faculty %>%
group_by(gender) %>%
summarize_at(c("Teilnehmende in % Studierende", "Betroffene in % Teilnehmende", "Betroffene in % Studierende"), ~ mean(.x, na.rm = TRUE)) %>%
melt(id.vars = "gender", value.name = "mean")
df_faculty_selected = df_faculty %>%
filter(faculty == codes_faculty[codes_faculty$code == faculty_code, ]$faculty)  %>%
select(gender, c("Teilnehmende in % Studierende", "Betroffene in % Teilnehmende", "Betroffene in % Studierende")) %>%
melt(id.vars = "gender", value.name = "selected") %>%
left_join(df_faculty_mean) %>%
mutate(direction = (case_when(mean < selected ~ "überdurchschnittlich",
mean > selected ~ "unterdurchschnittlich",
mean == selected ~ "durchschnittlich")))
df_faculty_selected$gender = factor(df_faculty_selected$gender, levels = c("weiblich", "andere"))
df_faculty_selected$variable = factor(df_faculty_selected$variable, levels = c("Betroffene in % Studierende", "Betroffene in % Teilnehmende", "Teilnehmende in % Studierende"))
(p1 = ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue, show.legend = FALSE,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = "Fakultät")) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt"), fill = "white") +
scale_color_manual(values = c(weiblich = dark_blue, andere = teal),
name = "") +
scale_shape_manual(breaks=c('Durchschnitt', "Fakultät"),
values=c('Durchschnitt'=21, "Fakultät"=16),
name = "") +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black")))
ggsave(paste0("reports/figures/P5.2A_", codes_faculty[codes_faculty$code == faculty_code, ]$faculty, ".png"), dpi = 700, width = 11, height = 2)
df_faculty_affected_waffle = df_faculty_all %>%
left_join(df_all_students_gender) %>%
filter(faculty == codes_faculty[codes_faculty$code == faculty_code, ]$faculty) %>%
summarize_at(c("Betroffene", "Teilnehmende", "Studierende"), ~ sum(.x, na.rm = TRUE), 0) %>%
mutate("Teilnehmende" = round(100*Teilnehmende/ Studierende, 0),
"Betroffene" = round(100*Betroffene/ Studierende, 0),
"Studierende" = 100 - Teilnehmende - Betroffene)
p2 = waffle(df_faculty_affected_waffle, rows = 4, colors = c(teal, dark_blue, soft_blue), legend_pos = "bottom")
ggsave(paste0("reports/figures/P5.2B_", codes_faculty[codes_faculty$code == faculty_code, ]$faculty, ".png"), dpi = 700, width = 11, height = 2)
(plot_grid(p1, p2, ncol = 1))
ggsave(paste0("reports/figures/P5.2C_", codes_faculty[codes_faculty$code == faculty_code, ]$faculty, ".png"), dpi = 700)
}
for (i in c(1:6)) {
faculty_benchmark(faculty_code = i, full_data, main_question_q3, codes_faculty, codes_gender, df_all_students)
}
#faculty comparison
faculty_benchmark = function(faculty_code, full_data, main_question_q3, codes_faculty, codes_gender, df_all_students) {
df_all_students_gender = df_all_students %>%
rename(weiblich = total_female,
andere = total_other) %>%
melt(measure.vars = c("weiblich", "andere"), variable.name = "gender", value.name = "Studierende") %>%
select(-total)
df_faculty_affected = full_data %>%
select(Q2.2, Q2.1, main_question_q3) %>%
filter(!is.na(Q2.2),
!is.na(Q2.1)) %>%
mutate(faculty = codes_faculty$faculty[match(Q2.2, codes_faculty$code)],
gender = codes_gender$gender[match(Q2.1, codes_gender$code)],
gender = replace(gender, gender %in% c("männlich", "keine Angabe"), "andere")) %>%
filter_at(vars(main_question_q3), any_vars (. == 1)) %>%
select(-Q2.2, -Q2.1) %>%
count(faculty, gender)
df_faculty_all = full_data %>%
select(Q2.2, Q2.1) %>%
filter(!is.na(Q2.2),
!is.na(Q2.1)) %>%
mutate(faculty = codes_faculty$faculty[match(Q2.2, codes_faculty$code)],
gender = codes_gender$gender[match(Q2.1, codes_gender$code)],
gender = replace(gender, gender %in% c("männlich", "keine Angabe"), "andere")) %>%
count(faculty, gender) %>%
rename("Teilnehmende" = n) %>%
left_join(df_faculty_affected) %>%
rename("Betroffene" = n) %>%
filter(faculty != "keine Angabe")
df_faculty = df_faculty_all %>%
left_join(df_all_students_gender) %>%
mutate("Teilnehmende in % Studierende" = 100*Teilnehmende/ Studierende,
"Betroffene in % Teilnehmende" = 100*Betroffene/ Teilnehmende,
"Betroffene in % Studierende" = 100*Betroffene/ Studierende)
df_faculty_mean = df_faculty %>%
group_by(gender) %>%
summarize_at(c("Teilnehmende in % Studierende", "Betroffene in % Teilnehmende", "Betroffene in % Studierende"), ~ mean(.x, na.rm = TRUE)) %>%
melt(id.vars = "gender", value.name = "mean")
df_faculty_selected = df_faculty %>%
filter(faculty == codes_faculty[codes_faculty$code == faculty_code, ]$faculty)  %>%
select(gender, c("Teilnehmende in % Studierende", "Betroffene in % Teilnehmende", "Betroffene in % Studierende")) %>%
melt(id.vars = "gender", value.name = "selected") %>%
left_join(df_faculty_mean) %>%
mutate(direction = (case_when(mean < selected ~ "überdurchschnittlich",
mean > selected ~ "unterdurchschnittlich",
mean == selected ~ "durchschnittlich")))
df_faculty_selected$gender = factor(df_faculty_selected$gender, levels = c("weiblich", "andere"))
df_faculty_selected$variable = factor(df_faculty_selected$variable, levels = c("Betroffene in % Studierende", "Betroffene in % Teilnehmende", "Teilnehmende in % Studierende"))
(p1 = ggplot(data = df_faculty_selected) + theme_void() +
geom_link(alpha = .5, color = soft_blue, show.legend = FALSE,
aes(x = variable, xend = variable, y = mean, yend = selected, colour = gender, size = after_stat(index))) +
geom_point(size = 6,
aes(y = selected, x = variable, color = gender, shape = "Fakultät")) +
geom_point(size = 2, stroke = 1,
aes(y = mean, x = variable, color = gender, shape = "Durchschnitt"), fill = "white") +
scale_color_manual(values = c(weiblich = teal, andere = dark_blue),
name = "") +
scale_shape_manual(breaks=c('Durchschnitt', "Fakultät"),
values=c('Durchschnitt'=21, "Fakultät"=16),
name = "") +
scale_x_discrete( expand = c(0.05,0.05)) +
scale_y_continuous(name = "Prozent (%)") +
coord_flip() +
theme(axis.text = element_text(),
axis.title.x = element_text(),
axis.line.x = element_line(color = "grey50"),
axis.ticks.x = element_line(color = "black")))
ggsave(paste0("reports/figures/P5.2A_", codes_faculty[codes_faculty$code == faculty_code, ]$faculty, ".png"), dpi = 700, width = 11, height = 2)
df_faculty_affected_waffle = df_faculty_all %>%
left_join(df_all_students_gender) %>%
filter(faculty == codes_faculty[codes_faculty$code == faculty_code, ]$faculty) %>%
summarize_at(c("Betroffene", "Teilnehmende", "Studierende"), ~ sum(.x, na.rm = TRUE), 0) %>%
mutate("Teilnehmende" = round(100*Teilnehmende/ Studierende, 0),
"Betroffene" = round(100*Betroffene/ Studierende, 0),
"Studierende" = 100 - Teilnehmende - Betroffene)
p2 = waffle(df_faculty_affected_waffle, rows = 4, colors = c(teal, dark_blue, soft_blue), legend_pos = "bottom")
ggsave(paste0("reports/figures/P5.2B_", codes_faculty[codes_faculty$code == faculty_code, ]$faculty, ".png"), dpi = 700, width = 11, height = 2)
(plot_grid(p1, p2, ncol = 1))
ggsave(paste0("reports/figures/P5.2C_", codes_faculty[codes_faculty$code == faculty_code, ]$faculty, ".png"), dpi = 700)
}
for (i in c(1:6)) {
faculty_benchmark(faculty_code = i, full_data, main_question_q3, codes_faculty, codes_gender, df_all_students)
}
